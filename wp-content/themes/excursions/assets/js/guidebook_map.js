let ombListImagesLoaded=!1;const baseColor="#005281",activeColor="#bc3134",placeholderUrl="/wp-content/themes/excursions/assets/img/placeholder_3x2.png";function addMarker(a,b){const{lat:c}=a,{lng:d}=a,e=a.post_id,f=a.permalink,{title:g}=a,h=a.thumb_url;let i="<h3><a href=\"{{ properties.url }}\">{{ properties.title }}</a></h3>";h&&(i+="<img src=\"{{ properties.thumbUrl }}\" />");const j=ymaps.templateLayoutFactory.createClass(i);let k="<p>{{ properties.title }}</p>";h&&(k+="<img src=\"{{ properties.thumbUrl }}\" />");const l=ymaps.templateLayoutFactory.createClass(k),m=h?`<img src="${h}" />`:"",n=new ymaps.Placemark([c,d],{postId:e,url:f,title:g,thumbUrl:h,clusterCaption:g,balloonContent:`${m}<p><a href="${f}">Перейти на страницу объекта >></a></p>`},{preset:"islands#Icon",iconColor:baseColor,balloonContentLayout:j,hintContentLayout:l});n.events.add("mouseenter",a=>{const b=a.get("target");b.options.set("iconColor",activeColor)}),n.events.add("mouseleave",a=>{const b=a.get("target");b.options.set("iconColor",baseColor)}),n.events.add("balloonopen",a=>{const b=a.get("target");b.options.set("iconColor",activeColor)}),n.events.add("balloonclose",a=>{const b=a.get("target");b.options.set("iconColor",baseColor)}),b.markers.push(n)}function NewMap(a,b,c){const d=a.querySelector(".omb_map"),e=document.createElement("div");e.className="ev-map",d.appendChild(e);const f=new ymaps.Map(e,{center:[52.967631,36.069584],zoom:12});return 768>=window.screen.width&&f.behaviors.disable("scrollZoom"),f.markers=[],b.forEach(a=>addMarker(a,f)),c.add(f.markers),f.geoObjects.add(c),0<b.length&&f.setBounds(f.geoObjects.getBounds(),{checkZoomRange:!0}).then(()=>{16<f.getZoom()&&f.setZoom(16)}),f}function filterByTitle(a,b){const c=a.toUpperCase();b&&[].forEach.call(b.querySelectorAll("li"),a=>{const b=a.querySelector(".li_title"),d=b.textContent||b.innerText;d.toUpperCase().includes(c)?a.removeAttribute("style"):a.setAttribute("style","display: none;")})}function checkItemOff(a,b,c,d=!0){const e=a.dataset.post_id;b.search(`properties.postId = ${e}`).each(a=>{const b=c.getObjectState(a);b.isShown&&(b.isClustered?b.cluster.options.set("clusterIconColor",baseColor):a.options.set("iconColor",baseColor))}),d&&(a.classList.remove("checkedItem"),document.querySelector("#infoImg").src="",document.querySelector("#infoRef").href="",document.querySelector("#infoRef").textContent="")}function checkItemOn(a,b,c,d,e){[].forEach.call(b.querySelectorAll(".checkedItem"),a=>checkItemOff(a,d,e)),a.classList.add("checkedItem");const f=a.dataset.post_id;d.search(`properties.postId = ${f}`).each(a=>{const b=e.getObjectState(a);b.isShown&&(b.isClustered?b.cluster.options.set("clusterIconColor",activeColor):a.options.set("iconColor",activeColor))});const g=c.find(a=>a.post_id==f),h=g.thumb_url?g.thumb_url:placeholderUrl;document.querySelector("#infoImg").src=h,document.querySelector("#infoRef").href=g.permalink,document.querySelector("#infoRef").textContent=g.title}function NewObjList(a,b,c,d){const e=a.querySelector(".omb_list"),f=document.createElement("ul");f.className="obj_list",f.setAttribute("tabindex",0),b.forEach(a=>{const b=a.thumb_url,c=b?"":"class=\"no_thumb\"",d=`
            <li ${c} data-post_id="${a.post_id}" tabindex="-1">
                <span class="li_title">${a.title}</span>
                <span><a class="hiddenlink" href="${a.permalink}" title="Ссылка на ${a.title}">[>>]</a></span>
                <img data-src="${b||placeholderUrl}" />
            </li>`;f.insertAdjacentHTML("beforeend",d)}),e.appendChild(f),f.addEventListener("keydown",a=>{let b;switch(a.key){case"ArrowDown":case"Enter":a.preventDefault(),b=f.querySelector("li"),b&&(b.setAttribute("tabindex",0),b.focus());break;default:}}),[].forEach.call(a.querySelectorAll("input[name=\"omb_list_view\"]"),a=>{a.addEventListener("change",function(){"imgs"===this.value?(!ombListImagesLoaded&&([].forEach.call(f.querySelectorAll("img[data-src]"),a=>{a.setAttribute("src",a.dataset.src),a.removeAttribute("data-src")}),ombListImagesLoaded=!0),f.classList.add("list_images")):f.classList.remove("list_images")})}),a.querySelector("#filterByTitle").addEventListener("input",function(){filterByTitle(this.value,f)}),[].forEach.call(f.querySelectorAll("li"),a=>{a.addEventListener("click",function(a){a.target.matches("a")||(this.classList.contains("checkedItem")?checkItemOff(this,c,d):checkItemOn(this,f,b,c,d))}),768<window.screen.width&&(a.addEventListener("mouseenter",function(){this.classList.contains("checkedItem")||checkItemOn(this,f,b,c,d)}),a.addEventListener("keydown",function(b){let c=this,d=!1;switch(b.key){case"ArrowUp":do c=c.previousElementSibling;while(null!=c&&"none"===c.style.display);c||(c=f),d=!0;break;case"ArrowDown":do c=c.nextElementSibling;while(null!=c&&"none"===c.style.display);c||(c=f.firstElementChild),d=!0;break;case"Enter":c=f,d=!0;break;default:}d&&(c.focus(),c.setAttribute("tabindex",0),a.setAttribute("tabindex",-1),b.preventDefault(),b.stopPropagation())}),a.addEventListener("focus",function(){this.classList.contains("checkedItem")||checkItemOn(this,f,b,c,d)}))})}function NewObjMap(a){const b=a.querySelector(".om_content");b.insertAdjacentHTML("beforeend","\n        <div class=\"om_flex\">\n            <div class=\"om_block omb_map\"></div>\n            <div class=\"om_aside\">\n                <div class=\"om_block omb_filter\">\n                    <input type=\"search\" placeholder=\"\u041F\u043E\u0438\u0441\u043A \u043F\u043E \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u044E\" id=\"filterByTitle\">\n                    <div class=\"ctrl_flex\">\n                        <label title=\"\u041F\u0435\u0440\u0435\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u0435 \u0432\u0438\u0434\u0430\">\n                            <input class=\"hidden_input\" type=\"radio\" name=\"omb_list_view\" value=\"list\" checked>\n                            <span class=\"chb_svg\"></span>\n                        </label>\n                        <label title=\"\u041F\u0435\u0440\u0435\u043A\u043B\u044E\u0447\u0435\u043D\u0438\u0435 \u0432\u0438\u0434\u0430\">\n                            <input class=\"hidden_input\" type=\"radio\" name=\"omb_list_view\" value=\"imgs\">\n                            <span class=\"chb_svg\"></span>\n                        </label>\n                    </div>\n                </div>\n                <div class=\"om_block omb_list\"></div>\n                <div class=\"om_block omb_info\">\n                    <img id=\"infoImg\" src=\"\" />\n                    <a id=\"infoRef\" href=\"\"></a>\n                </div>\n            </div>\n        </div>");const c={headers:{"content-type":"application/x-www-form-urlencoded; charset=UTF-8"}},d=window.location.search?`${window.location.search}&`:"?",e=`${myajax.url+d}action=get_sights`;getScript(ymapsApiUrl).then(()=>{fetch(e,c).then(a=>a.json()).then(b=>{ymaps.ready(()=>{const c=new ymaps.Clusterer({clusterIconColor:baseColor}),d=NewMap(a,b,c),e=ymaps.geoQuery(d.markers);NewObjList(a,b,e,c)})})})}function changeObjMapState(a){switch(a.dataset.state){case"init":NewObjMap(a),a.setAttribute("data-state","open");break;case"close":a.setAttribute("data-state","open");break;case"open":a.setAttribute("data-state","close");break;default:}"open"===a.dataset.state?NavBlock.classList.remove("fixable"):NavBlock.classList.add("fixable")}function initGBMap(){const a=document.querySelector(".obj_map");if(a){const b=a.querySelector(".omb_panel");b&&b.removeAttribute("style");const c=a.querySelector(".OpenMap_btn");c&&c.addEventListener("click",()=>changeObjMapState(a)),768<window.screen.width&&changeObjMapState(a)}}window.addEventListener("load",initGBMap);